package application;

import java.net.URL;
import java.util.ArrayList;
import java.util.ResourceBundle;

import javafx.beans.binding.BooleanBinding;
import javafx.fxml.FXML;
import javafx.fxml.Initializable;
import javafx.scene.control.Button;
import javafx.scene.control.TableColumn;
import javafx.scene.control.TableView;
import javafx.scene.control.TextField;
import javafx.scene.control.cell.PropertyValueFactory;
import model.Contato;

public class AgendaContatosController implements Initializable {

	@FXML
	private TableView<Contato> tvContatos;

	@FXML
	private TableColumn<Contato, String> tcNome;

	@FXML
	private TableColumn<Contato, String> tcNumero;

	@FXML
	private TextField txtNome;

	@FXML
	private TextField txtNumero;

	@FXML
	private Button btnIncluir;
	@FXML
	private Button btnExcluir;
	@FXML
	private Button btnAtualizar;
	@FXML
	private Button btnLimpar;

	private ArrayList<Contato> listaContatos = new ArrayList<>();

	@Override
	public void initialize(URL arg0, ResourceBundle arg1) {
		// TODO Auto-generated method stub

		tcNome.setCellValueFactory(new PropertyValueFactory<>("nome"));
		tcNumero.setCellValueFactory(new PropertyValueFactory<>("numero"));

		// logica de preenchimento do formulario ao clique na tabela TV
		tvContatos.getSelectionModel().selectedItemProperty().addListener((b, o, n) -> {
			if (n != null) {
				txtNome.setText(n.getNome());
				txtNumero.setText(n.getNumero());
			}
		});
		//variavel do tipo BooleanBinding Ã© uma classe
		BooleanBinding temContatoSelecionado = tvContatos.getSelectionModel().selectedItemProperty().isNotNull();
		
		btnIncluir.disableProperty().bind(temContatoSelecionado);
		btnAtualizar.disableProperty().bind(temContatoSelecionado.not());
		
	}

	public void onBtnIncluirClick() {
		
		String nomeDigitado = txtNome.getText();
		String numeroDigitado = txtNumero.getText();

		Contato contato = new Contato(nomeDigitado, numeroDigitado);

		listaContatos.add(contato);

		tvContatos.getItems().setAll(listaContatos);
		reset();
	}
	
	public void onBtnAtualizarClick() {
		
		String nomeDigitado = txtNome.getText();
		String numeroDigitado = txtNumero.getText();
		
		Contato contatoSelecionado = tvContatos.getSelectionModel().getSelectedItem();
		
		contatoSelecionado.setNome(nomeDigitado);
		contatoSelecionado.setNumero(numeroDigitado);
		
		tvContatos.getItems().setAll(listaContatos);
		
		
		reset();
		
	}
	
	public void onBtnExcluirClick() {
		Contato contatoSelecionado = tvContatos.getSelectionModel().getSelectedItem();
		
		listaContatos.remove(contatoSelecionado);
		
		tvContatos.getItems().setAll(listaContatos);
		reset();

	}
	public void onBtnLimparClick() {
		reset();
	}
	private void reset() {
		txtNome.setText("");
		txtNumero.setText("");
		tvContatos.getSelectionModel().clearSelection();
	}
}
